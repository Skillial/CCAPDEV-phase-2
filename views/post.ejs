<!DOCTYPE html>
<html>
    <head>
		<meta charset="UTF-8">
		<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
		<script src="/javascript/react.js"></script>
        <script src="/javascript/postView.js"></script>
		<title>
			<%= post.title %>
		</title>
        <link rel="icon" href="../images/icon.png" sizes="32x32" type="image/png">
        <link rel="stylesheet" type="text/css" href="/css/styles.css">
	</head>
	<body>
        <script src="/javascript/navbar.js" type="text/javascript"></script>
		<script>
			createNavbar('../../' ,<%= isLoggedIn %>);
		</script>
		<div class="border">
			<div class="content_list">
			
			</div>
            <script>
                <% if (!post.isDeleted) { %>
                  let postID = '<%= post._id %>',
                      pauthor = '<%= post.author %>',
                      ptitle = '<%= post.title %>',
                      pdesc = '<%= post.content %>',
                      ppostedDate = new Date('<%= post.createDate %>').toLocaleString();
                  let peditedDate = '<%= post.editDate %>';
                  if (peditedDate) {
                    peditedDate = new Date(peditedDate).toLocaleString();
                  } else {
                    peditedDate = '- Not Edited'; //not edited
                  }
                  prating = '<%= post.rating %>', 
                  pmedia = '<%= post.media %>'; //remove?
                
                  let ppfp = '<%= author.pfp_link %>';
                
                  $('.content_list').append(newPost(postID, pauthor, ptitle, ppfp, pdesc, ppostedDate, peditedDate, prating, pmedia));
                <% } else { %>
                  // Display a message when the post is deleted
                  $('.content_list').append('<div>The original post was deleted, but you can still view the comments.</div>');
                <% } %>
              </script>
              


                <div class="comments-section" id="commentsContainer">
                    <!-- Comments will be dynamically added here -->
                </div>

                <script>
                    // Get the comments data from the server-side and convert it to a JavaScript object
                    const commentsData = <%= JSON.stringify(comments) %>;

                    // Function to append comments to the comments container
                    function appendComments(commentsData) {
                    const commentsContainer = document.getElementById('commentsContainer');

                    commentsData.forEach((comment) => {
                        const commentElement = newComment(comment.author, comment.ppfp, comment.content, comment.pcount, comment._id, comment.children);
                        commentsContainer.appendChild(commentElement);
                    });
                    }

                    // Append the comments after the page loads
                    document.addEventListener('DOMContentLoaded', () => {
                    appendComments(commentsData);
                    });
                </script>

            
		</div>
	</body>
</html>